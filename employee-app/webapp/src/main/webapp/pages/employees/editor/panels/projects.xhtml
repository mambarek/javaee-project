<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
        xmlns:composite="http://xmlns.jcp.org/jsf/composite"
        xmlns:tag="http://it2go.com/employee"
        xmlns:empl="http://xmlns.jcp.org/jsf/composite/employees"
        xmlns:jsf="http://xmlns.jcp.org/jsf"
        xmlns:pe="http://xmlns.jcp.org/jsf/composite/prime-empl">

    <div jsf:id="projectList">
    <div id="accordion" class="accordion">
        <ui:repeat value="#{editEmployeeController.model.projects}" var="project" varStatus="index">
            <div class="card panel">
                <div class="card-header header" id="headingOne_#{index}">
                    <div class="mb-0">
                        <button class="btn btn-link title" data-toggle="collapse" data-target="#collapseOne_#{index}"
                                aria-expanded="true" aria-controls="collapseOne_#{index}" onclick="return false;">
                            <i class="fas fa-caret-right fa-lg"/> Project: #{project.name}
                        </button>
                    </div>
                </div>
                <div id="collapseOne_#{index}" class="show" aria-labelledby="headingOne_#{index}" >
                    <div class="card-body">
                        <empl:row value="#{project.name}" readOnly="true"
                                    label="#{employeeMsg['employee.editor.projects.name']}"
                                    isRequired="true" >
                            <f:validateLength minimum="3" maximum="100" for="input"/>
                        </empl:row>
                        <div jsf:id="DateRangeValidator_BEGIN">
                            <empl:row value="#{project.begin}" inputType="date" model="#{project}" readOnly="true"
                                        label="#{employeeMsg['employee.editor.projects.begin']}" ajaxRender=":DateRangeValidator_END"
                                        isRequired="true" placeholder="#{employeeMsg['employee.app.date.pattern']}">
                                <f:validator validatorId="DateRangeValidator" for="input"/>
                                <f:attribute name="DateRangeValidator_BEGIN" value="true" />
                                <f:attribute name="endFieldLabel" value="#{employeeMsg['employee.editor.projects.end']}" />
                            </empl:row>
                        </div>

                        <empl:row value="#{project.tilToday}" inputType="checkbox" label="#{employeeMsg['employee.editor.projects.tiltoday']}" readOnly="true">
                            <f:ajax execute="@this" render="@form" event="click" onevent="hightlightMustFields" listener="#{project.setEnd(null)}"/>
                        </empl:row>

                        <div jsf:id="DateRangeValidator_END" jsf:rendered="#{!project.tilToday}">
                            <empl:row value="#{project.end}" inputType="date" model="#{project}"
                                        label="#{employeeMsg['employee.editor.projects.end']}" ajaxRender=":DateRangeValidator_BEGIN"
                                        isRequired="true" placeholder="#{employeeMsg['employee.app.date.pattern']}">
                                <f:validator validatorId="DateRangeValidator" for="input" />
                                <f:attribute name="DateRangeValidator_END" value="true" />
                                <f:attribute name="beginFieldLabel" value="#{employeeMsg['employee.editor.projects.begin']}" />
                            </empl:row>
                        </div>

                        <pe:textArea value="#{project.description}" label="#{employeeMsg['employee.editor.projects.desc']}">

                        </pe:textArea>

                        <div class="form-group row">
                            <div class="col m-3">
                                <a class="btn btn-primary" jsf:action="#{editEmployeeController.removeProject(project)}"  jsf:id="removeProject">
                                    <f:ajax render="@none" onevent="refreshProjectsView"/>
                                    #{employeeMsg['employee.editor.projects.button.delete']}</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ui:repeat>
    </div>

    </div>
    <div class="form-group row">
        <!--<label class="col-md-3 col-form-label" />-->
        <hr/>
        <div class="col mt-2">
            <a class="btn btn-primary" jsf:action="#{editEmployeeController.addProject}"  jsf:id="addAction">
                <f:ajax render="projectList" onevent="hightlightMustFields"/>
                #{employeeMsg['employee.editor.projects.button.add']}</a>
        </div>
    </div>
    <h:commandButton id="removeProjectConfirm" styleClass="d-none">
        <f:ajax render="projectList" onevent="hightlightMustFields"/>
    </h:commandButton>
    <h:outputScript >
        // remove button cannot rebuild the view. a jsf issue
        // so rfresh the view outgoing from an extern button (this is a work around)
        function refreshProjectsView(){
        var id = '#' + encodeId('#{cc.clientId}' + 'removeProjectConfirm');
        console.info('click button id: ' + id);
        $(encodeId('#projects-form:removeProjectConfirm')).click();
        }

    </h:outputScript>
</ui:composition>