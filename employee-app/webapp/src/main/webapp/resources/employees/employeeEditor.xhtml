<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:composite="http://xmlns.jcp.org/jsf/composite"
      xmlns:employees="http://xmlns.jcp.org/jsf/composite/employees"
      xmlns:behavior="http://it2go.com/employee">

<composite:interface componentType="employee.component">
    <composite:attribute name="model" type="com.it2go.employee.entities.Employee" required="true"/>
    <composite:actionSource name="saveButton" event="click" targets="#{cc.clientId}:employeeForm:save"/>
    <composite:clientBehavior name="save" event="click" targets="#{cc.clientId}:employeeForm:save"/>
    <composite:clientBehavior name="saveOk" event="click" targets="#{cc.clientId}:saveHiddenForm:saveOk"/>
    <composite:actionSource name="saveOkButton" event="click" targets="#{cc.clientId}:saveHiddenForm:saveOk"/>
    <composite:clientBehavior name="cancel" event="click" targets="#{cc.clientId}:employeeForm:cancel"/>
    <composite:actionSource name="delete" targets="#{cc.clientId}:employeeForm:delete"/>
    <composite:attribute name="saveConfirmFunc" />
    <composite:attribute name="deleteConfirmFunc" />
    <composite:attribute name="renderAfterSave"/>
</composite:interface>
<composite:implementation>

<div id="#{cc.clientId}">
<div class="card" >
    <div class="card-header corp-block-form-header">
        #{cc.resourceBundleMap['employee.editor.title']}
    </div>
    <div class="card-block">
        <h:form id="employeeForm" styleClass="form-horizontal employeeForm" >
        <div class="form-row">
            <employees:formRow value="#{cc.attrs.model.firstName}"
                               label="#{cc.resourceBundleMap['employee.editor.firstName']}"
                               isRequired="false" disabled="true">
                <f:validateLength minimum="3" maximum="50"/>
            </employees:formRow>
            <employees:formRow value="#{cc.attrs.model.firstName}"
                               label="#{cc.resourceBundleMap['employee.editor.firstName']}"
                               isRequired="true" >
                <f:validateLength minimum="3" maximum="50"/>
            </employees:formRow>

            <employees:formRow value="#{cc.attrs.model.lastName}"
                               label="#{cc.resourceBundleMap['employee.editor.lastName']}"
                               isRequired="true" ajaxValidation="false">
                <f:validateLength minimum="3" maximum="50"/>
            </employees:formRow>

            <employees:formRow value="#{cc.attrs.model.birthDate}"
                               label="#{cc.resourceBundleMap['employee.editor.birthDate']}"
                               type="date"
                               placeholder="#{cc.resourceBundleMap['employee.app.date.pattern']}">
                <f:convertDateTime pattern="#{cc.resourceBundleMap['employee.app.date.pattern']}"/>
            </employees:formRow>

            <employees:formRow value="#{cc.attrs.model.salary}"
                               label="#{cc.resourceBundleMap['employee.editor.salary']}">
                <f:convertNumber currencySymbol="EUR" minFractionDigits="2" type="currency"/>
            </employees:formRow>
            <employees:formRow value="#{cc.attrs.model.salary}"
                               label="#{cc.resourceBundleMap['employee.editor.salary']}" readOnly="true">
                <f:convertNumber currencySymbol="EUR" minFractionDigits="2" type="currency"/>
            </employees:formRow>

            <div class="form-group row justify-content-end hidden-sm-down">
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary mr-2" jsf:immediate="true" jsf:id="cancel">
                        #{cc.resourceBundleMap['employee.editor.button.cancel']}</button>

                    <button type="submit" class="btn btn-primary mr-2" jsf:rendered="#{cc.attrs.model.isNew() == false}"
                            jsf:id="delete">
                        <!--First ask for confirmation -->
                        <behavior:confirm modalSelector="#myModal" message="Möchten Sie den Datensatz wirklich löschen?"
                                          ajax="true" successJsFunction="#{cc.attrs.deleteConfirmFunc}"/>
                        <i class="fa fa-trash-o" aria-hidden="true"/> #{cc.resourceBundleMap['employee.editor.button.delete']}
                    </button>

                    <button type="submit" class="btn btn-primary mr-3" jsf:id="save" >
                        #{cc.resourceBundleMap['employee.editor.button.save']}

                        <f:ajax execute="@form" render="#{cc.attrs.renderAfterSave}" onevent="handlaAjaxSaveEvent"/>

                    </button>
                </div>
            </div>
            <ui:remove>
            <div class="form-group row hidden-md-up">
                <div class="col-sm-12">
                    <button type="submit" class="btn btn-primary btn-block" jsf:immediate="true" jsf:id="cancel">
                        #{cc.resourceBundleMap['employee.editor.button.cancel']}
                    </button>
                </div>
                <div class="col-sm-12">
                    <button type="submit" class="btn btn-primary  btn-block" jsf:id="delete">
                        #{cc.resourceBundleMap['employee.editor.button.delete']}
                    </button>
                </div>
                <div class="col-sm-12">
                    <button type="submit" class="btn btn-primary  btn-block" jsf:id="save">
                        #{cc.resourceBundleMap['employee.editor.button.save']}
                    </button>
                </div>
            </div>
            </ui:remove>
        </div>
    </h:form>
        <h:messages style="color: red;"/>
        <!-- hidden form for confirmation dialog action delete-->
        <h:form id="saveHiddenForm">
            <h:commandButton id="showOverlay" style="display: none;" styleClass="showOverlay" >
                <f:ajax onevent="showOverlay" render="content"/>
            </h:commandButton>
            <h:commandButton id="saveOk" style="display: none;" styleClass="saveOk">
                <f:ajax execute="@this"  render="content"/>
            </h:commandButton>
        </h:form>
    </div>
</div>
</div>
    <div class="modal fade" id="myModal" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Löschen</h5>
                </div>
                <div class="modal-body">
                    <p class="modal-message">Möchten Sie den Datensatz wirklich löschen?</p>
                </div>
                <div class="modal-footer">
                    <button id="modal-ok" type="button" class="btn btn-primary" onclick="saveAndshowOverlayOnly()">Löschen</button>
                    <button id="modal-cancel" type="button" class="btn btn-secondary" data-dismiss="modal">Abbrechen</button>
                </div>
            </div>
        </div>
    </div>
    <!-- overlay simulation -->
    <div class="modal fade" id="overlayModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Daten werden verarbeitet</h5>
                </div>
                <div class="modal-body">
                    <p class="modal-message">Möchten Sie den Datensatz wirklich löschen?</p>
                </div>
                <div class="modal-footer">
                    <button id="overlay-modal-ok" type="button" class="btn btn-primary" >Yes</button>
                    <button id="overlay-modal-cancel" type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                </div>
            </div>
        </div>
    </div>
    <h:outputScript >
        $(document).ready(function() {
            $('.date').datepicker({
                language: '#{webFlowController.locale}',
                autoClose: true,
                todayHighlight: true,
                format: "#{cc.resourceBundleMap['employee.app.javascript.date.pattern']}"
            })
        });
    </h:outputScript>
</composite:implementation>

</ui:composition>